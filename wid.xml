<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<muclient>
<plugin
   name="wid"
   author="Khrysis"
   id="16537fffd375971a606cc8c0"
   language="Lua"
   purpose="gets id number of primary and second weapon then saves to variables primaryweapon and secondweapon"
   save_state="y"
   date_written="2022-01-09 09:40:16"
   requires="5.07"
   version="1.1"
   >
<description trim="y">
Weapon ID Tracker
</description>>
</plugin>

<triggers>
  <trigger
  enabled="y"
  match="^You wield (.*?)\.$"
  regexp="y"
  send_to="12"
  sequence="100"
>
<send>
  -- Only run if we aren't already in the middle of an update
  if not is_updating then
    is_updating = true
    EnableTriggerGroup("eqdata", true)
    SendNoEcho("eqdata")
  end
</send>
</trigger>

  <trigger
   enabled="n"
   match="^(\d+)\,(.*)\,(.+)\,(\d+)\,(\d+)\,(\d+),(-?\d+),(-?\d+)$"
   omit_from_output="y"
   regexp="y"
   send_to="12"
   sequence="100"
   group="eqdata"
  >
  <send>
  local captured_string = "%2"
  if %7 == 25 and
  string.find(captured_string,"K") then 
SetVariable("secondweapon","'%1'")
SetVariable("secondary","'%3'")
 end
 if %7 == 24 and
 string.find(captured_string,"K") then
SetVariable("primary","'%3'")
SetVariable("primaryweapon","'%1'")
  end</send>
  </trigger>

  <trigger
  enabled="n"
  match="^(\{\/eqdata\})$|^(\{eqdata\})$|^(\{eqdata \d*\})$"
  omit_from_output="y"
  regexp="y"
  sequence="100"
  send_to="12"
  group="eqdata"
>
<send>
  -- Check for the closing tag to wrap things up
  if "%1" == "{/eqdata}" then
    EnableTriggerGroup("eqdata", false)
    is_updating = false
  end
</send>
</trigger>
</triggers>

<aliases>
  <alias
   script="OnHelp"
   match="wid help"
   enabled="y"
  >
  </alias>
  <alias
   match="woff"
   enabled="y"
   expand_variables="y"
   sequence="100"
  >
  <send>remove wielded
remove second</send>
  </alias>
  <alias
   match="won"
   enabled="y"
   expand_variables="y"
   sequence="100"
  >
  <send>wear @primaryweapon
dual @secondweapon</send>
  </alias>
  <alias
   match="wid"
   enabled="y"
   expand_variables="y"
   send_to="12"
   sequence="100"
  >
  <send>AnsiNote("Primary weapon ",(ColoursToANSI("@primary")),"    Id number is : ","@primaryweapon")
        AnsiNote("Secondary weapon ",(ColoursToANSI("@secondary")),"    Id number is : ","@secondweapon")
  </send>
  </alias>
  <alias
   match="wid off"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>EnableTriggerGroup("eqdata", false)
        Note ("Eqdata command not being hidden and will resume normal when you wear new weapons")
  </send>
  </alias>
</aliases>

<script>
<![CDATA[
require "aardwolf_colors"

function OnHelp ()
  local name = GetPluginInfo(GetPluginID(), 1)
  local ver  = GetPluginInfo(GetPluginID(), 19)

  Note("") 
  ColourNote("silver", "", "================== ", "cyan", "", name .. " v" .. ver, "silver", "", " ==================")
  
  -- We use ColourNote for each line to ensure perfect alignment and add some color
  ColourNote("cyan", "", "  won     ", "silver", "", " - Equip saved primary and secondary weapons.")
  ColourNote("cyan", "", "  woff    ", "silver", "", " - Remove both wielded weapons.")
  ColourNote("cyan", "", "  wid     ", "silver", "", " - View stored weapon names and their ID numbers.")
  ColourNote("cyan", "", "  wid help", "silver", "", " - Show this help information.")
  Note("")
  ColourNote("orange", "", "  wid off ", "silver", "", " - Use this if 'eqdata' output stays hidden.")
  
  ColourNote("silver", "", "============================================================")
  Note("") 
end

function OnPluginInstall ()
  ColourNote ("blue","yellow","wid Plugin Installed! Type wid help - to show help")
end
]]>
</script> 

</muclient>
